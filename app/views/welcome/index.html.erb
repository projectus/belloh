<script>
  $(document).bind('ready', function(){
      $("select").each(function(){
          $(this).wrap('<div class="selectbox"/>');
          $(this).after("<span class='selecttext'></span><span class='select-arrow'></span>");
      });

      $("select").each(function(){
          var val = $(this).children("option:selected").text();
          $(this).next(".selecttext").text(val);
          $(this).change(function(){
              var val = $(this).children("option:selected").text();
              $(this).next(".selecttext").text(val);
          });
      });

      $(".button-tog").bind("click", function(){
          if (!$(this).hasClass("button-active")){

              $(".button-tog").each(function(){
                  $(this).removeClass("button-active")
              })

              $(this).addClass("button-active")
          }
      })

      $(".button-tog").css("cursor", "pointer")

      $(".button-tog").bind("mouseover", function(){

         $(this).css({
                 "-moz-box-shadow": "0 0 3px 1px #888",
                 "-webkit-box-shadow": "0 0 3px 1px #888",
                 "box-shadow": "0 0 3px 1px #888"
         })
      }).bind("mouseout", function(){
          $(this).css({
              "-moz-box-shadow": "none",
              "-webkit-box-shadow": "none",
              "box-shadow": "none"
          })


      })


  });
</script>

<div class="top-div">
  <div class="geo-bar">
    <div id="geostatus">Current Location: <%= @location %></div>

    <div class="pull-right">
      <img class="locator-img" src ="http://png.findicons.com/files/icons/2597/the_clean_desk/40/location_fav.png" />
    </div>
  </div>

  <div class="top-content">
    <div id="new_post_box" class="post-neutral">
	    <%= render 'posts/form' %>
    </div>
    <div class="map-box">
      <img class="map" src="#" />
    </div>
  </div>
</div>

<div class="margin"></div>

<div class="wrapper">
  <div class="wrapper-top">
    <div class="button-group">

      <div id="current-location" class="button-tog">
        <img src="http://png.findicons.com/files/icons/974/glyphish/11/map_pin.png" />
        Current Location
      </div>

      <div id="all-places" class="button-active button-tog">
        <img src="http://png-1.findicons.com/files/icons/2212/carpelinx/16/browser.png" />
        All Places
      </div>

      Filter By:
       <select>
         <option>All</option>
         <option>Sender Description</option>
         <option>Receiver Description</option>
         <option>Message Content</option>

       </select>

      <input type="text" placeholder="Filter Texts...">


    </div>

    <!--

    Sort By Time
    <select>
      <option>Most Recent</option>
      <option>Least Recent</option>
    </select>
    <input type="text" placeholder="Filter Posts">

    -->
  </div>

  <div class="wrapper-content">
	  
    <div id="posts">
	    <%= render 'posts/list' %>
	  </div>
  </div>
</div>

<script>
  // Javascript to fetch user's location and fill with relevant posts
  $(function(){

      $(".locator-img").click(function(){
          getLocation(getPosts);
      });

      $("#current-location").click(function(){




          getLocation(getPosts);
      });

      $("#all-places").click(function(){
	      var world = {
	          "coords": {
	              "latitude": "nil",
	              "longitude": "nil"
	          }
	      }
        getPosts(world);
      });

			$("#post_mood").change(function() {
			    var mood = $("#post_mood option:selected").text();
				  switch(mood)
					{
					case "Neutral":
					  $("#new_post_box").removeClass();
					  $("#new_post_box").addClass('post-neutral');
					  break;
					case "Positive":
					  $("#new_post_box").removeClass();
				    $("#new_post_box").addClass('post-positive');
					  break;
					case "Negative":
					  $("#new_post_box").removeClass();
				    $("#new_post_box").addClass('post-negative');
					  break;
					case "Caution":
					  $("#new_post_box").removeClass();
				    $("#new_post_box").addClass('post-caution');
					  break;
					default:
					  break;
					}
			});
  });

	function getPosts(position) {
        var lat=position.coords.latitude;
		var lon=position.coords.longitude;
		var the_data = 'lat=' + encodeURIComponent(lat)
	               +'&lon=' + encodeURIComponent(lon);

        var srcString = "http://maps.googleapis.com/maps/api/staticmap?center=" + lat + "," + lon + "&zoom=11&size=200x200&sensor=false"

        $(".map").attr("src", srcString)


		$.ajax({
		  data: the_data,
		  type: 'get',
		  url: '<%=j currloc_path %>'
		});
	}
</script>
